<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GreenITE - Play With Greenie</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; background: #f0f8f0; }
        .header { background: #2d5a2d; color: white; padding: 10px 0; }
        .nav { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; padding: 0 20px; }
        .nav-links { display: flex; gap: 20px; }
        .nav-links a { color: white; text-decoration: none; padding: 8px 16px; border-radius: 4px; }
        .nav-links a.active { background: #4CAF50; }
        .welcome { font-size: 18px; }
        .container { max-width: 800px; margin: 20px auto; padding: 20px; }
        .upload-section { background: white; border-radius: 10px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .drop-zone { border: 2px dashed #4CAF50; border-radius: 10px; padding: 40px; text-align: center; margin: 20px 0; background: #f9f9f9; }
        .drop-zone.dragover { background: #e8f5e8; }
        input[type="file"] { display: none; }
        .upload-btn { background: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; transition: all 0.3s; }
        .upload-btn:hover { background: #45a049; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        .action-item { animation: slideInLeft 0.5s ease-out; }
        @keyframes slideInLeft { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }
        .upload-section, .bill-comparison, .actions-log { animation: fadeInUp 0.6s ease-out; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .action-input { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        .actions-log { background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .action-item { padding: 10px; margin: 5px 0; background: #f1f8e9; border-radius: 5px; border-left: 4px solid #4CAF50; }
        .bill-comparison { background: white; border-radius: 10px; padding: 20px; margin: 20px 0; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .bill-inputs { display: flex; gap: 20px; margin: 10px 0; }
        .bill-inputs input { flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="header">
        <div class="nav">
            <div class="welcome">Welcome, <span id="username"></span></div>
            <div class="nav-links">
                <a href="index.html">Log Out</a>
                <a href="chatbot.html">Chat With Greenie</a>
                <a href="notice.html">User Notice</a>
                <a href="play.html" class="active">Play With Greenie</a>
                <a href="badges.html">Badges</a>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="upload-section">
            <h3>Share Your Sustainability Actions</h3>
            <input type="text" class="action-input" id="actionInput" placeholder="I rode a bike to work today...">
            <button onclick="addActionFromInput()" class="upload-btn">Add Action</button>
            
            <div class="drop-zone" id="dropZone">
                <p>Drag and drop files here or <button class="upload-btn" onclick="document.getElementById('fileInput').click()">Upload Files</button></p>
                <p>Supports: PDF, Images, DOCX</p>
                <input type="file" id="fileInput" multiple accept=".pdf,.jpg,.jpeg,.png,.docx">
            </div>
        </div>

        <div class="bill-comparison">
            <h3>Bill Comparison</h3>
            <div class="bill-inputs">
                <input type="number" id="prevElectric" placeholder="Previous Electric Bill ($)">
                <input type="number" id="currElectric" placeholder="Current Electric Bill ($)">
            </div>
            <div class="bill-inputs">
                <input type="number" id="prevWater" placeholder="Previous Water Bill ($)">
                <input type="number" id="currWater" placeholder="Current Water Bill ($)">
            </div>
            <button onclick="compareBills()" class="upload-btn">Compare Bills</button>
            <div id="billResult"></div>
        </div>

        <div class="actions-log">
            <h3>Your Sustainability Actions</h3>
            <div id="actionsList"></div>
        </div>
    </div>

    <script>
        const user = localStorage.getItem('user');
        if (!user) window.location.href = 'index.html';
        document.getElementById('username').textContent = user;

        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');

        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('dragover');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });

        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        function handleFiles(files) {
            for (let file of files) {
                addAction(`Uploaded file: ${file.name}`);
            }
        }

        function addActionFromInput() {
            const input = document.getElementById('actionInput');
            const action = input.value.trim();
            if (action) {
                addAction(action);
                input.value = '';
            }
        }

        function addAction(text) {
            // Save to localStorage
            const actions = JSON.parse(localStorage.getItem('sustainableActions') || '[]');
            const actionEntry = {
                text: text,
                date: new Date().toLocaleDateString(),
                timestamp: Date.now()
            };
            actions.push(actionEntry);
            localStorage.setItem('sustainableActions', JSON.stringify(actions));
            
            // Display the action
            displayActions();
            
            // Track badge progress
            trackBadgeProgress(text);
        }
        
        function displayActions() {
            const actions = JSON.parse(localStorage.getItem('sustainableActions') || '[]');
            const actionsList = document.getElementById('actionsList');
            actionsList.innerHTML = '';
            
            actions.forEach(action => {
                const div = document.createElement('div');
                div.className = 'action-item';
                div.textContent = `${action.date}: ${action.text}`;
                actionsList.appendChild(div);
            });
        }
        
        // Load saved actions on page load
        displayActions();

        function trackBadgeProgress(action) {
            const badges = JSON.parse(localStorage.getItem('badges') || '{}');
            const actionLower = action.toLowerCase();
            let category = 'general';
            
            // Transport category
            if (actionLower.includes('bike') || actionLower.includes('cycle') || actionLower.includes('walk') || actionLower.includes('bus') || actionLower.includes('train') || actionLower.includes('public transport') || actionLower.includes('mrt') || actionLower.includes('subway')) {
                badges.ecoCommuter = (badges.ecoCommuter || 0) + 1;
                category = 'transport';
            }
            // Recycling category
            else if (actionLower.includes('recycle') || actionLower.includes('reuse') || actionLower.includes('compost') || actionLower.includes('donate') || actionLower.includes('repair')) {
                badges.recycling = (badges.recycling || 0) + 1;
                category = 'recycling';
            }
            // Energy category
            else if (actionLower.includes('energy') || actionLower.includes('electricity') || actionLower.includes('light') || actionLower.includes('led') || actionLower.includes('solar') || actionLower.includes('power')) {
                badges.energy = (badges.energy || 0) + 1;
                category = 'energy';
            }
            // Water category
            else if (actionLower.includes('water') || actionLower.includes('shower') || actionLower.includes('tap') || actionLower.includes('rain')) {
                badges.water = (badges.water || 0) + 1;
                category = 'water';
            }
            
            badges.starter = (badges.starter || 0) + 1;
            localStorage.setItem('badges', JSON.stringify(badges));
            
            // Show category feedback
            showCategoryFeedback(category);
        }
        
        function showCategoryFeedback(category) {
            const categoryNames = {
                transport: 'ðŸš´ Transport',
                recycling: 'â™»ï¸ Recycling',
                energy: 'ðŸ’¡ Energy',
                water: 'ðŸ’§ Water',
                general: 'ðŸŒ± General'
            };
            
            const feedback = document.createElement('div');
            feedback.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #4CAF50; color: white; padding: 10px 20px; border-radius: 5px; z-index: 1000; animation: slideInRight 0.5s;';
            feedback.textContent = `${categoryNames[category]} action tracked!`;
            document.body.appendChild(feedback);
            
            setTimeout(() => feedback.remove(), 3000);
        }

        function compareBills() {
            const prevE = parseFloat(document.getElementById('prevElectric').value) || 0;
            const currE = parseFloat(document.getElementById('currElectric').value) || 0;
            const prevW = parseFloat(document.getElementById('prevWater').value) || 0;
            const currW = parseFloat(document.getElementById('currWater').value) || 0;

            const electricSaving = prevE - currE;
            const waterSaving = prevW - currW;
            const totalSaving = electricSaving + waterSaving;

            const result = document.getElementById('billResult');
            result.innerHTML = `
                <h4>Bill Comparison Results:</h4>
                <p>Electric: ${electricSaving >= 0 ? 'Saved' : 'Increased'} $${Math.abs(electricSaving).toFixed(2)}</p>
                <p>Water: ${waterSaving >= 0 ? 'Saved' : 'Increased'} $${Math.abs(waterSaving).toFixed(2)}</p>
                <p><strong>Total: ${totalSaving >= 0 ? 'Saved' : 'Increased'} $${Math.abs(totalSaving).toFixed(2)}</strong></p>
                ${totalSaving > 0 ? '<p>ðŸŒ± Great job on reducing your consumption!</p>' : '<p>ðŸ’¡ Try to reduce your usage next month!</p>'}
            `;
            
            // Track badge progress for bill savings
            if (electricSaving > 0) trackBadgeProgress('saved electricity');
            if (waterSaving > 0) trackBadgeProgress('saved water');
        }ld(feedback);
            
            setTimeout(() => feedback.remove(), 3000);
        }

        function compareBills() {
            const prevE = parseFloat(document.getElementById('prevElectric').value) || 0;
            const currE = parseFloat(document.getElementById('currElectric').value) || 0;
            const prevW = parseFloat(document.getElementById('prevWater').value) || 0;
            const currW = parseFloat(document.getElementById('currWater').value) || 0;

            const electricSaving = prevE - currE;
            const waterSaving = prevW - currW;
            const totalSaving = electricSaving + waterSaving;

            const result = document.getElementById('billResult');
            result.innerHTML = `
                <h4>Bill Comparison Results:</h4>
                <p>Electric: ${electricSaving >= 0 ? 'Saved' : 'Increased'} $${Math.abs(electricSaving).toFixed(2)}</p>
                <p>Water: ${waterSaving >= 0 ? 'Saved' : 'Increased'} $${Math.abs(waterSaving).toFixed(2)}</p>
                <p><strong>Total: ${totalSaving >= 0 ? 'Saved' : 'Increased'} $${Math.abs(totalSaving).toFixed(2)}</strong></p>
                ${totalSaving > 0 ? '<p>ðŸŒ± Great job on reducing your consumption!</p>' : '<p>ðŸ’¡ Try to reduce your usage next month!</p>'}
            `;
            
            // Track badge progress for bill savings
            if (electricSaving > 0) trackBadgeProgress('saved electricity');
            if (waterSaving > 0) trackBadgeProgress('saved water');
        }
    </script>
    <style>
        @keyframes slideInRight { from { transform: translateX(100%); } to { transform: translateX(0); } }
    </style>
</body>
</html>